<div class="header-container">
  <div class="logo-container">
    <a (click)="toggleSidebar()" href="#" class="sidebar-toggle">
      <nb-icon icon="menu-2-outline"></nb-icon>
    </a>
    <a class="logo" href="#" (click)="navigateHome()">
      <img src="../../../../assets/img/eduatlas.png" width="100%" />
    </a>
  </div>

  <nb-card class="mt-4">
    <nb-select status="primary" placeholder="Select Institute" fullWidth (click)="setInstitutes()"
      (selectedChange)="onSelect($event)">
      <nb-option value="">Select Institute</nb-option>
      <nb-option *ngFor="let item of institutes" value="{{ item._id }}">{{
        item.basicInfo.name
      }}</nb-option>
    </nb-select>
  </nb-card>
</div>

<div class="header-container">
  <nb-actions size="small">
    <nb-action class="control-item" icon="email-outline" [nbPopover]="chatPopup" nbPopoverPlacement="bottom">
    </nb-action>
    <nb-action class="control-item" icon="bell-outline" [nbPopover]="notificationPopup" nbPopoverPlacement="bottom"></nb-action>
    <nb-action class="control-item" icon="power" (click)="logout()"></nb-action>
    <nb-action class="user-action" *nbIsGranted="['view', 'user']">
      <nb-user [name]="name" [nbContextMenu]="userMenu"> </nb-user>
    </nb-action>
  </nb-actions>
</div>

<ng-template #chatPopup>
  <div class="chatPopup">

    <nb-tabset fullWidth>
      <nb-tab tabTitle="Teachers">
        <nb-list>
          <nb-list-item *ngFor="let user of users">
            <nb-user [name]="user.name" [title]="user.title" style="cursor:pointer" (click)="openChatBox(user)">
            </nb-user>
          </nb-list-item>
        </nb-list>
      </nb-tab>
      <nb-tab tabTitle="Students">
        <nb-list>
          <nb-list-item *ngFor="let user of users">
            <nb-user [name]="user.name" [title]="user.title" style="cursor:pointer" (click)="openChatBox(user)">
            </nb-user>
          </nb-list-item>
        </nb-list>
      </nb-tab>
    </nb-tabset>
    
  </div>
</ng-template>

<ng-template #notificationPopup>
  <div class="chatPopup">
    <nb-list>
      <nb-list-item *ngFor="let user of users">
        <nb-user [name]="user.name" [title]="user.title" style="cursor:pointer" (click)="openChatBox(user)">
        </nb-user>
      </nb-list-item>
    </nb-list>
  </div>
</ng-template>

<ng-template #chatWindow let-data>
  <div>
    <nb-chat *ngFor="let chat of chats" [status]="chat.status" size="small">
      <nb-chat-message *ngFor="let msg of chat.messages" [type]="msg.type" [message]="msg.text" [reply]="msg.reply"
        [sender]="msg.user.name" [date]="msg.date" [files]="msg.files" [avatar]="msg.user.avatar">
      </nb-chat-message>
      <nb-chat-form (send)="sendMessage(chat.messages, $event)"></nb-chat-form>
    </nb-chat>
  </div>
</ng-template>